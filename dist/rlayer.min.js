/*
 RaphaelLayer, a JavaScript library for overlaying Raphael objects onto Leaflet interactive maps. http://dynmeth.github.com/RaphaelLayer
 (c) 2012-2013, David Howell, Dynamic Methods Pty Ltd

 Version 0.3.3

 Fork by Arnooo: https://github.com/Arnooo/RaphaelLayer

*/

!function(){var t,a;"undefined"!=typeof exports?t=exports:(t={},a=window.R,t.noConflict=function(){return window.R=a,t},window.R=t),t.version="0.3.3",t.Layer=L.Class.extend({includes:L.Mixin.Events,initialize:function(t){this.options=t},update:function(t){this.options=t},onAdd:function(t){this._map=t,this._map._initRaphaelRoot(),this._paper=this._map._paper,this._set=this._paper.set(),t.on("viewreset",this.projectLatLngs,this),t.on("resize",this.projectLatLngs,this),this.projectLatLngs()},onRemove:function(t){t.off("viewreset",this.projectLatLngs,this),t.off("resize",this.projectLatLngs,this),this._map=null,this._set.forEach(function(t){t.remove()},this),this._set.clear()},projectLatLngs:function(){},animate:function(t,a,i,e){return this._set.animate(t,a,i,e),this},hover:function(t,a,i,e){return this._set.hover(t,a,i,e),this},attr:function(t,a){return this._set.attr(t,a),this}}),L.Map.include({_initRaphaelRoot:function(){this._raphaelRoot||(this._raphaelRoot=this._panes.overlayPane,this._paper=Raphael(this._raphaelRoot),this.on("moveend",this._updateRaphaelViewport),this._updateRaphaelViewport())},_updateRaphaelViewport:function(){{var t=L.Path.CLIP_PADDING,a=this.getSize(),i=L.DomUtil.getPosition(this._mapPane),e=i.multiplyBy(-1)._subtract(a.multiplyBy(t)),r=e.add(a.multiplyBy(1+2*t)),o=r.x-e.x,n=r.y-e.y,s=this._raphaelRoot;this._panes.overlayPane}this._paper.setSize(o,n),L.DomUtil.setPosition(s,e),s.setAttribute("width",o),s.setAttribute("height",n),this._paper.setViewBox(e.x,e.y,o,n,!1)}}),t.Marker=t.Layer.extend({initialize:function(a,i,e,r){t.Layer.prototype.initialize.call(this,r),this._latlng=a,this._pathString="string"==typeof i?i:"M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584c-1.979,0-3.584-1.604-3.584-3.584S14.021,7.416,16,7.416S19.584,9.021,19.584,11S17.979,14.584,16,14.584z",this._attr="object"==typeof i?i:e?e:{fill:"#000"}},projectLatLngs:function(){this._path&&this._path.remove();var t=this._map.latLngToLayerPoint(this._latlng),a=Raphael.pathBBox(this._pathString);this._path=this._paper.path(this._pathString).attr(this._attr).translate(t.x-1.05*a.width,t.y-1.15*a.height).toFront(),this._set.push(this._path)}}),t.Pulse=t.Layer.extend({initialize:function(a,i,e,r,o){t.Layer.prototype.initialize.call(this,o),this._latlng=a,this._radius="number"==typeof i?i:6,this._attr="object"==typeof i?i:"object"==typeof e?e:{fill:"#30a3ec",stroke:"#30a3ec"},this._pulseAttr="object"==typeof i?e:"object"==typeof r?r:{"stroke-width":3,stroke:this._attr.stroke},this._repeat=3},onRemove:function(a){t.Layer.prototype.onRemove.call(this,a),this._marker&&this._marker.remove(),this._pulse&&this._pulse.remove()},projectLatLngs:function(){this._marker&&this._marker.remove(),this._pulse&&this._pulse.remove();var t=this._map.latLngToLayerPoint(this._latlng);this._marker=this._paper.circle(t.x,t.y,this._radius).attr(this._attr),this._pulse=this._paper.circle(t.x,t.y,this._radius).attr(this._pulseAttr);var a=Raphael.animation({"0%":{transform:"s0.3",opacity:1},"100%":{transform:"s3.0",opacity:0,easing:"<"}},1e3);this._pulse.animate(a.repeat(this._repeat))}}),t.Polyline=t.Layer.extend({initialize:function(a,i,e){t.Layer.prototype.initialize.call(this,e),this._latlngs=a,this._attr=i||{fill:"#000",stroke:"#000"}},projectLatLngs:function(){this._set.clear(),this._path&&this._path.remove(),this._path=this._paper.path(this.getPathString()).attr(this._attr).toBack(),this._set.push(this._path)},getPathString:function(){for(var t=0,a=this._latlngs.length,i="";a>t;t++){var e=this._map.latLngToLayerPoint(this._latlngs[t]);i+=(t?"L":"M")+e.x+" "+e.y}return i}}),t.Polygon=t.Layer.extend({initialize:function(a,i,e){t.Layer.prototype.initialize.call(this,e),1==a.length&&a[0]instanceof Array&&(a=a[0]),this._latlngs=a,this._attr=i||{fill:"rgba(255, 0, 0, 0.5)",stroke:"#f00","stroke-width":2}},projectLatLngs:function(){this._path&&this._path.remove(),this._path=this._paper.path(this.getPathString()).attr(this._attr).toBack(),this._set.push(this._path)},getPathString:function(){for(var t=0,a=this._latlngs.length,i="";a>t;t++){var e=this._map.latLngToLayerPoint(this._latlngs[t]);i+=(t?"L":"M")+e.x+" "+e.y}return i+="Z"}}),t.PolygonGlow=t.Layer.extend({initialize:function(a,i,e){t.Layer.prototype.initialize.call(this,e),this._latlngs=a,this._attr=i||{fill:"rgba(255, 0, 0, 1)",stroke:"#f00","stroke-width":3}},onRemove:function(a){t.Layer.prototype.onRemove.call(this,a),this._path&&this._path.remove()},projectLatLngs:function(){this._path&&this._path.remove(),this._path=this._paper.path(this.getPathString()).attr(this._attr).toBack();var t=this._path,a=function(){t.animate({"fill-opacity":.25},1e3,"<",i)},i=function(){t.animate({"fill-opacity":1},1e3,"<",a)};i()},getPathString:function(){for(var t=0,a=this._latlngs.length,i="";a>t;t++){var e=this._map.latLngToLayerPoint(this._latlngs[t]);i+=(t?"L":"M")+e.x+" "+e.y}return i+="Z"}}),t.Bezier=t.Layer.extend({initialize:function(a,i,e){t.Layer.prototype.initialize.call(this,e),this._latlngs=a,this._attr=i},projectLatLngs:function(){this._path&&this._path.remove();var t=this._map.latLngToLayerPoint(this._latlngs[0]),a=this._map.latLngToLayerPoint(this._latlngs[1]),i=this.getControlPoint(t,a);this._path=this._paper.path("M"+t.x+" "+t.y+"Q"+i.x+" "+i.y+" "+a.x+" "+a.y).attr(this._attr).toBack(),this._set.push(this._path)},getControlPoint:function(t,a){var i={x:0,y:0};i.x=t.x+(a.x-[t.x])/2,i.y=t.y+(a.y-[t.y])/2;var e=0;return this.closeTo(t.x,a.x)&&!this.closeTo(t.y,a.y)?(e=1*(t.x-a.x)+15*(t.x>=a.x?1:-1),i.x=Math.max(t.x,a.x)+e):(e=1.5*(a.y-t.y)+15*(t.y<a.y?1:-1),i.y=Math.min(t.y,a.y)+e),i},closeTo:function(t,a){var i=15;return t-a>-i&&i>t-a}}),t.BezierAnim=t.Layer.extend({initialize:function(a,i,e,r){t.Layer.prototype.initialize.call(this,r),this._latlngs=a,this._attr=i?i:{stroke:"blue","stroke-width":4},this._cb=e,this._enablePathAnimation=!0,this._enableMarkerAnimation=!0,this._dataToSend={}},update:function(a){t.Layer.prototype.update.call(this,a.objectOptions),this.initialize(a.markers,a.attribut,a.callbacks,a.objectOptions),this.projectLatLngs()},onRemove:function(a){t.Layer.prototype.onRemove.call(this,a),this._reset()},projectLatLngs:function(){function t(t,a){this.update&&(this.update(t-(this.dx||0),a-(this.dy||0)),this.dx=t,this.dy=a)}function a(){this.dx=this.dy=0}function i(){r._map&&r._map.dragging.disable(),r._cb&&r._cb.onHoverControls&&r._cb.onHoverControls()}function e(){r._map&&r._map.dragging.enable(),r._cb&&r._cb.onDragControls&&(r._cb.onDragControls(r._dataToSend),r._dataToSend={})}var r=this;if(r._reset(),r._latlngs.length>0){r._setControls=r._paper.set(),r._setMarkers=r._paper.set();for(var o=0;o<r._latlngs.length;o++){var n=!1,s=r._map.latLngToLayerPoint(r._latlngs[o]);if(0===o)r._arrayBezier.push("M");else if(o>0&&o%2===1)r._arrayBezier.push("S");else if(o>1){var h=r._arrayBezier[r._arrayBezier.length-1],p=s.subtract(h);n=s.add(p)}r._arrayBezier.push([s.x,s.y]);var _=r._addControlPoint(o,s);r._addMarker(o,_),n&&r._addControlPoint(o-1,n)}r._pathBezier=r._paper.path(r._arrayBezier).hide(),r.options&&r.options.renderLastOnly&&r._arrayBezier.length>2&&(r._pathBezierFixed=r._paper.path(r._arrayBezier.slice(0,r._arrayBezier.length-3)),r._pathBezierFixed.attr(r._attr),r._startNormalized=r._pathBezierFixed.getTotalLength()/r._pathBezier.getTotalLength()),r._pathControls=r._paper.path(r._arrayControls),r._setControls.push(r._pathControls),r._pathBezier.attr(r._attr),r._pathBezier.attr({"stroke-linecap":"round",cursor:"pointer"}),r._pathControls.attr({stroke:"#000","stroke-dasharray":"- "}),r.options&&!r.options.editor?r._setControls.hide():(r._setControls.show(),r._setControls.toFront(),r._pathControls.toBack(),r._setMarkers.toFront()),r.options&&r.options.editor&&(r._setControls.drag(t,a),r._setMarkers.drag(t,a)),r._setControls.hover(i,e),r._setMarkers.hover(i,e),r._pathBezier.click(function(){r._cb&&r._cb.onClickPath&&r.options.pathInfo&&r._cb.onClickPath(r.options.pathInfo)}),r._addAnimatedPath(),r._addAnimatedMarker()}},_reset:function(){this._pathBezier&&this._pathBezier.remove(),this._pathControls&&this._pathControls.remove(),this._circleControls&&this._circleControls.remove(),this._setControls&&this._setControls.remove(),this._setMarkers&&this._setMarkers.remove(),this._pathBezierAnimated&&this._pathBezierAnimated.remove(),this._markerAnimated&&this._markerAnimated.remove(),this._pathBezierFixed&&this._pathBezierFixed.remove(),this._arrayBezier=[],this._arrayControls=[],this._startNormalized=0},_updateLatlngs:function(t,a){var i=this;t<i._latlngs.length&&(i._latlngs[t]=a,i.options.markers[t].latlng=a)},_addControlPoint:function(t,a){var i=this,e=i._setControls.length;t>0&&(i._arrayControls.push(i._arrayControls.length%3===0?"M":"L"),i._arrayControls.push([a.x,a.y]));var r=i._paper.circle(a.x,a.y,5).attr({fill:"#fff",stroke:"#000",cursor:"pointer"});return r.data("pointID",t),r.data("controlID",e),i.options&&i.options.markersInfos&&r.data("info",i.options.markersInfos[t]),i._setControls.push(r),0===t?r.update=function(t,a){var e=this.attr("cx")+t,r=this.attr("cy")+a;this.attr({cx:e,cy:r});var o=this.data("pointID"),n=this.data("controlID");i._arrayBezier[1][0]=e,i._arrayBezier[1][1]=r;var s=i._setMarkers[o].attr("x")+t,h=i._setMarkers[o].attr("y")+a;i._setMarkers[o].attr({x:s,y:h}),i._pathBezier.attr({path:i._arrayBezier});var p=i._map.layerPointToLatLng([e,r]);i._dataToSend[n]={info:this.data("info"),latlng:p}}:t>0&&(i._arrayControls.length-1)%3===1?(r.update=function(t,a){var e=this.attr("cx")+t,r=this.attr("cy")+a;this.attr({cx:e,cy:r});var o=this.data("pointID"),n=3*Math.floor((o+1)/2);i._arrayBezier[n][0]=e,i._arrayBezier[n][1]=r,i._pathBezier.attr({path:i._arrayBezier});var s=this.data("controlID");i._arrayControls[2*s-1][0]=e,i._arrayControls[2*s-1][1]=r,i._pathControls.attr({path:i._arrayControls}),i._setControls[s+2].updatePosition(-t,-a);var h=i._map.layerPointToLatLng([e,r]);i._dataToSend[s]={info:this.data("info"),latlng:h}},r.updatePosition=function(t,a){var e=this.attr("cx")+t,r=this.attr("cy")+a;this.attr({cx:e,cy:r});var o=this.data("controlID");i._arrayControls[2*o-1][0]=e,i._arrayControls[2*o-1][1]=r,i._pathControls.attr({path:i._arrayControls});var n=this.data("pointID"),s=3*Math.floor((n+1)/2);i._arrayBezier[s][0]=e,i._arrayBezier[s][1]=r,i._pathBezier.attr({path:i._arrayBezier});var h=i._map.layerPointToLatLng([e,r]);i._dataToSend[o]={info:this.data("info"),latlng:h}}):t>0&&i._arrayControls.length%3===0?(r.update=function(t,a){var e=this.attr("cx")+t,r=this.attr("cy")+a;this.attr({cx:e,cy:r});{var o=this.data("pointID"),n=this.data("controlID");3*Math.floor((o+1)/2)}i._pathBezier.attr({path:i._arrayBezier}),i._arrayControls[2*n-1][0]=e,i._arrayControls[2*n-1][1]=r,i._pathControls.attr({path:i._arrayControls}),i._setControls[n-2].updatePosition(-t,-a)},r.updatePosition=function(t,a){var e=this.attr("cx")+t,r=this.attr("cy")+a;this.attr({cx:e,cy:r});{var o=this.data("controlID"),n=this.data("pointID");3*Math.floor((n+1)/2)}i._arrayControls[2*o-1][0]=e,i._arrayControls[2*o-1][1]=r,i._pathControls.attr({path:i._arrayControls})}):t>0&&(i._arrayControls.length-1)%3===0&&(r.update=function(t,a){var e=this.attr("cx")+t,r=this.attr("cy")+a;this.attr({cx:e,cy:r});var o=this.data("pointID"),n=this.data("controlID"),s=1+3*Math.floor(o/2);i._arrayBezier[s][0]=e,i._arrayBezier[s][1]=r;var h=i._setMarkers[o].attr("x")+t,p=i._setMarkers[o].attr("y")+a;i._setMarkers[o].attr({x:h,y:p}),i._arrayControls[2*n-1][0]=e,i._arrayControls[2*n-1][1]=r,i._setControls[n-1].updatePosition(t,a),i._setControls[n+1].updatePosition(t,a);var _=i._map.layerPointToLatLng([e,r]);i._dataToSend[n]={info:this.data("info"),latlng:_},i._updateLatlngs(o,_)}),e},_addMarker:function(t,a){var i=this;if(i._setMarkers&&i.options&&i.options.markers&&i.options.markers[t]){var e=i._map.latLngToLayerPoint(i.options.markers[t].latlng),r=null;i.options.markers[t].icon?(r=i._paper.image(i.options.markers[t].icon.url,e.x-i.options.markers[t].icon.anchor[0],e.y-i.options.markers[t].icon.anchor[1],i.options.markers[t].icon.size[0],i.options.markers[t].icon.size[1]).show(),r.attr({cursor:"pointer"}),r.data("controlID",a),r.data("pointID",t),i.options.markersInfos&&r.data("info",i.options.markersInfos[t]),r.update=function(t,a){var e=this.data("controlID");i._setControls[e].update(t,a)},r.click(function(){i._cb&&i._cb.onClickMarker&&i._cb.onClickMarker(this.data("info"))}),i._setMarkers.push(r)):(r=i._paper.circle(0,0,0).hide(),r.update=function(){},i._setMarkers.push(r))}},_addAnimatedPath:function(){var t=this,a=function(){t._pathBezierAnimated&&t._pathBezierAnimated.hide(),t._pathBezierFixed&&t._pathBezierFixed.hide(),t._pathBezier.show(),t._circleControls&&(t._circleControls.toFront(),t._circleControls.show()),t._cb&&t._cb.onAnimationEnd&&t._cb.onAnimationEnd(),t._markers&&t._markers.show()};t.options&&t.options.transition?(this._paper.customAttributes.alongBezier=function(t){var a=this.data("reverse"),i=this.data("pathLength");return t>0?{path:this.data("bezierPath").getSubpath(a?(1-t)*i:0,a?i:t*i)}:void 0},t._pathBezierAnimated=t._paper.path().data("bezierPath",t._pathBezier).data("pathLength",t._pathBezier.getTotalLength()).data("reverse",!1).attr(t._attr).attr({alongBezier:t._startNormalized}),t._enablePathAnimation?(t._enablePathAnimation=!1,setTimeout(function(){t._pathBezierAnimated.stop().animate({alongBezier:1},t.options.transition.animationDuration,a)},t.options.startAnimateTimeout)):a()):a()},_addAnimatedMarker:function(){var t=this;if(t.options&&t.options.transition&&t.options.transition.icon&&""!==t.options.transition.icon.url){this._paper.customAttributes.followBezier=function(a){this.show();var i=this.data("reverse"),e=this.data("pathLength"),r=this.data("bezierPath").getPointAtLength(i?e:a*e);return!isNaN(r.x)&&a>0?{x:r.x-t.options.transition.icon.anchor[0],y:r.y-t.options.transition.icon.anchor[1],width:t.options.transition.icon.size[0],height:t.options.transition.icon.size[1]}:void 0},t._markerAnimated=t._paper.image(t.options.transition.icon.url).data("bezierPath",t._pathBezier).data("pathLength",t._pathBezier.getTotalLength()).data("reverse",!1).attr({fill:"#fff",stroke:"#000",followBezier:t._startNormalized}),t._markerAnimated.click(function(){t._cb&&t._cb.onClickMarker&&t.options.pathInfo&&t._cb.onClickMarker(t.options.pathInfo)}),t._markerAnimated.hide();var a=function(){t._markerAnimated.attr({followBezier:t.options.transition.icon.stopAt}),t._markerAnimated&&t.options.transition.icon.hideOnStop?t._markerAnimated.hide():t._markerAnimated.attr({cursor:"pointer"})};t._enableMarkerAnimation?(t._enableMarkerAnimation=!1,setTimeout(function(){t._markerAnimated.stop().animate({followBezier:t.options.transition.icon.stopAt},t.options.transition.animationDuration,a)},t.options.startAnimateTimeout)):a()}}}),t.TrackAnim=t.Layer.extend({initialize:function(a,i,e,r){t.Layer.prototype.initialize.call(this,r),this._latlngs=a,this._attr=i?i:{stroke:"blue","stroke-width":4},this._cb=e,this._enablePathAnimation=!0,this._enableMarkerAnimation=!0,this._dataToSend={}},update:function(a){t.Layer.prototype.update.call(this,a.objectOptions),this.initialize(a.markers,a.attribut,a.callbacks,a.objectOptions),this.projectLatLngs()},onRemove:function(a){t.Layer.prototype.onRemove.call(this,a),this._reset()},projectLatLngs:function(){var t=this;if(t._reset(),t._latlngs.length>0){t._setMarkers=t._paper.set();for(var a=0;a<t._latlngs.length;a++){var i=t._map.latLngToLayerPoint(t._latlngs[a]);0===a?t._arrayBezier.push("M"):a>0&&t._arrayBezier.push("L"),t._arrayBezier.push([i.x,i.y])}if(t.options&&t.options.markers)for(var e=0;e<t.options.markers.length;e++)t._addMarker(e);t._pathBezier=t._paper.path(t._arrayBezier).hide(),t.options&&t.options.renderLastOnly&&t._arrayBezier.length>2&&(t._pathBezierFixed=t._paper.path(t._arrayBezier.slice(0,t._arrayBezier.length-3)),t._pathBezierFixed.attr(t._attr),t._startNormalized=t._pathBezierFixed.getTotalLength()/t._pathBezier.getTotalLength()),t._pathBezier.attr(t._attr),t._pathBezier.attr({"stroke-linecap":"round",cursor:"pointer"}),t._pathBezier.click(function(){t._cb&&t._cb.onClickPath&&t.options.pathInfo&&t._cb.onClickPath(t.options.pathInfo)}),t._addAnimatedPath(),t._addAnimatedMarker()}},_reset:function(){this._pathBezier&&this._pathBezier.remove(),this._setMarkers&&this._setMarkers.remove(),this._pathBezierAnimated&&this._pathBezierAnimated.remove(),this._markerAnimated&&this._markerAnimated.remove(),this._pathBezierFixed&&this._pathBezierFixed.remove(),this._arrayBezier=[],this._startNormalized=0},_addMarker:function(t){var a=this;if(a._setMarkers&&a.options&&a.options.markers&&a.options.markers[t]){var i=a._map.latLngToLayerPoint(a.options.markers[t].latlng),e=null;a.options.markers[t].icon?(e=a._paper.image(a.options.markers[t].icon.url,i.x-a.options.markers[t].icon.anchor[0],i.y-a.options.markers[t].icon.anchor[1],a.options.markers[t].icon.size[0],a.options.markers[t].icon.size[1]).show(),e.attr({cursor:"pointer"}),e.data("pointID",t),a.options.markersInfos&&e.data("info",a.options.markersInfos[t]),e.click(function(){a._cb&&a._cb.onClickMarker&&a._cb.onClickMarker(this.data("info"))}),a._setMarkers.push(e)):(e=a._paper.circle(0,0,0).hide(),e.update=function(){},a._setMarkers.push(e))}},_addAnimatedPath:function(){var t=this,a=function(){t._pathBezierAnimated&&t._pathBezierAnimated.hide(),t._pathBezierFixed&&t._pathBezierFixed.hide(),t._pathBezier.show(),t._cb&&t._cb.onAnimationEnd&&t._cb.onAnimationEnd(),t._markers&&t._markers.show()};t.options&&t.options.transition?(this._paper.customAttributes.alongBezier=function(t){var a=this.data("reverse"),i=this.data("pathLength");return t>0?{path:this.data("bezierPath").getSubpath(a?(1-t)*i:0,a?i:t*i)}:void 0},t._pathBezierAnimated=t._paper.path().data("bezierPath",t._pathBezier).data("pathLength",t._pathBezier.getTotalLength()).data("reverse",!1).attr(t._attr).attr({alongBezier:t._startNormalized}),t._enablePathAnimation?(t._enablePathAnimation=!1,setTimeout(function(){t._pathBezierAnimated.stop().animate({alongBezier:1},t.options.transition.animationDuration,a)},t.options.startAnimateTimeout)):a()):a()},_addAnimatedMarker:function(){var t=this;if(t.options&&t.options.transition&&t.options.transition.icon&&""!==t.options.transition.icon.url){this._paper.customAttributes.followBezier=function(a){this.show();var i=this.data("reverse"),e=this.data("pathLength"),r=this.data("bezierPath").getPointAtLength(i?e:a*e);return!isNaN(r.x)&&a>0?{x:r.x-t.options.transition.icon.anchor[0],y:r.y-t.options.transition.icon.anchor[1],width:t.options.transition.icon.size[0],height:t.options.transition.icon.size[1]}:void 0},t._markerAnimated=t._paper.image(t.options.transition.icon.url).data("bezierPath",t._pathBezier).data("pathLength",t._pathBezier.getTotalLength()).data("reverse",!1).attr({fill:"#fff",stroke:"#000",followBezier:t._startNormalized}),t._markerAnimated.click(function(){t._cb&&t._cb.onClickMarker&&t.options.pathInfo&&t._cb.onClickMarker(t.options.pathInfo)}),t._markerAnimated.hide();var a=function(){t._markerAnimated.attr({followBezier:t.options.transition.icon.stopAt}),t._markerAnimated&&t.options.transition.icon.hideOnStop?t._markerAnimated.hide():t._markerAnimated.attr({cursor:"pointer"})};t._enableMarkerAnimation?(t._enableMarkerAnimation=!1,setTimeout(function(){t._markerAnimated.stop().animate({followBezier:t.options.transition.icon.stopAt},t.options.transition.animationDuration,a)},t.options.startAnimateTimeout)):a()}}}),t.FeatureGroup=L.FeatureGroup.extend({initialize:function(t,a){L.FeatureGroup.prototype.initialize.call(this,t,a)},animate:function(t,a,i,e){this.eachLayer(function(r){r.animate(t,a,i,e)})},onAdd:function(t){L.FeatureGroup.prototype.onAdd.call(this,t),this._set=this._map._paper.set();for(i in this._layers)this._set.push(this._layers[i]._set)},hover:function(t,a,i,e){return this.eachLayer(function(r){r.hover(t,a,i,e)}),this},attr:function(t,a){return this.eachLayer(function(i){i.attr(t,a)}),this}}),function(){function a(a){return t.FeatureGroup.extend({initialize:function(t,a){this._layers={},this._options=a,this.setLatLngs(t)},setLatLngs:function(t){var i=0,e=t.length;for(this.eachLayer(function(a){e>i?a.setLatLngs(t[i++]):this.removeLayer(a)},this);e>i;)this.addLayer(new a(t[i++],this._options));return this}})}t.MultiPolyline=a(t.Polyline),t.MultiPolygon=a(t.Polygon)}(),t.GeoJSON=t.FeatureGroup.extend({initialize:function(t,a){L.Util.setOptions(this,a),this._geojson=t,this._layers={},t&&this.addGeoJSON(t)},addGeoJSON:function(a){var i,e,r=a.features;if(r)for(i=0,e=r.length;e>i;i++)this.addGeoJSON(r[i]);else{var o="Feature"===a.type,n=o?a.geometry:a,s=t.GeoJSON.geometryToLayer(n,this.options.pointToLayer);this.fire("featureparse",{layer:s,properties:a.properties,geometryType:n.type,bbox:a.bbox,id:a.id,geometry:a.geometry}),this.addLayer(s)}}}),L.Util.extend(t.GeoJSON,{geometryToLayer:function(a,i){var e,r,o,n,s,h=a.coordinates,p=[];switch(a.type){case"Point":return e=this.coordsToLatLng(h),i?i(e):new t.Marker(e);case"MultiPoint":for(o=0,n=h.length;n>o;o++)e=this.coordsToLatLng(h[o]),s=i?i(e):new t.Marker(e),p.push(s);return new t.FeatureGroup(p);case"LineString":return r=this.coordsToLatLngs(h),new t.Polyline(r);case"Polygon":return r=this.coordsToLatLngs(h,1),new t.Polygon(r);case"MultiLineString":return r=this.coordsToLatLngs(h,1),new t.MultiPolyline(r);case"MultiPolygon":return r=this.coordsToLatLngs(h,2),new t.MultiPolygon(r);case"GeometryCollection":for(o=0,n=a.geometries.length;n>o;o++)s=this.geometryToLayer(a.geometries[o],i),p.push(s);return new t.FeatureGroup(p);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t,a){var i=parseFloat(t[a?0:1]),e=parseFloat(t[a?1:0]);return new L.LatLng(i,e,!0)},coordsToLatLngs:function(t,a,i){var e,r,o,n=[];for(r=0,o=t.length;o>r;r++)e=a?this.coordsToLatLngs(t[r],a-1,i):this.coordsToLatLng(t[r],i),n.push(e);return n}})}();